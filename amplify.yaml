version: 1

# Environment variables (set in AWS Amplify Console)
# GITHUB_TOKEN (if from private github API)

frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies...."
        - corepack enable 
        - corepack prepare pnpm@latest --activate
        - pnpm install --frozen-lockfile 

    build:
      commands:
        - echo "Building Nextjs application ...."
        - pnpm run build 
        - echo "Build completed successfully"

  artifacts:
    baseDirectory: .next 
    files:
      - '**/*'
    
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
      - ~/.pnpm-store/**/*

# Custom headers for security and performance 
customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Strict-Transport-Security'
          value: 'max-age=31536000; includeSubDomains'
        - key: 'X-Frame-Options'
          value: 'DENY'
        - key: 'X-Content-Type-Options'
          value: 'nosniff'
        - key: 'X-XSS-Protection'
          value: '1; mode=block'
        - key: 'Referrer-Policy'
          value: 'strict-origin-when-cross-origin'

    - pattern: '*.js'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'

    - pattern: '*.css'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'

    - pattern: '*.woff2'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'